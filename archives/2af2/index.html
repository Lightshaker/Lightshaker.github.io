<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"lightshaker.cn","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="学习内容来源：古月居ROS入门21讲  核心概念 通信机制：松耦合分布式软件框架 Node 节点 ROS Master 控制中心&#x2F;节点管理器 Topic 话题 -- 发布&#x2F;订阅式的单向异步通信 &amp;&amp; Message 话题内数据 .msg 话题通信适用于数据传输 Service 服务 -- 请求&#x2F;应答式的双向同步通信 .srv 服务通信适用于逻辑处理 Parameter 参数 --">
<meta property="og:type" content="article">
<meta property="og:title" content="ROS入门">
<meta property="og:url" content="https://lightshaker.cn/archives/2af2/index.html">
<meta property="og:site_name" content="Journey">
<meta property="og:description" content="学习内容来源：古月居ROS入门21讲  核心概念 通信机制：松耦合分布式软件框架 Node 节点 ROS Master 控制中心&#x2F;节点管理器 Topic 话题 -- 发布&#x2F;订阅式的单向异步通信 &amp;&amp; Message 话题内数据 .msg 话题通信适用于数据传输 Service 服务 -- 请求&#x2F;应答式的双向同步通信 .srv 服务通信适用于逻辑处理 Parameter 参数 --">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lightshaker.cn/archives/2af2/example_publisher.png">
<meta property="og:image" content="https://lightshaker.cn/archives/2af2/example_subscriber.png">
<meta property="og:image" content="https://lightshaker.cn/archives/2af2/%E8%87%AA%E5%AE%9A%E4%B9%89msg.png">
<meta property="og:image" content="https://lightshaker.cn/archives/2af2/person_msg%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C.png">
<meta property="og:image" content="https://lightshaker.cn/archives/2af2/example_client.png">
<meta property="og:image" content="https://lightshaker.cn/archives/2af2/example_server.png">
<meta property="og:image" content="https://lightshaker.cn/archives/2af2/Trigger.png">
<meta property="og:image" content="https://lightshaker.cn/archives/2af2/turtle_command_server1.png">
<meta property="og:image" content="https://lightshaker.cn/archives/2af2/turtle_command_server2.png">
<meta property="og:image" content="https://lightshaker.cn/archives/2af2/turtle_command_server3.png">
<meta property="og:image" content="https://lightshaker.cn/archives/2af2/%E8%87%AA%E5%AE%9A%E4%B9%89srv.png">
<meta property="og:image" content="https://lightshaker.cn/archives/2af2/srv_header_files.png">
<meta property="og:image" content="https://lightshaker.cn/archives/2af2/person%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C.png">
<meta property="article:published_time" content="2020-07-27T13:07:13.000Z">
<meta property="article:modified_time" content="2023-06-12T06:53:01.968Z">
<meta property="article:author" content="Lightshaker">
<meta property="article:tag" content="ROS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lightshaker.cn/archives/2af2/example_publisher.png">

<link rel="canonical" href="https://lightshaker.cn/archives/2af2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>ROS入门 | Journey</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Journey</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lightshaker.cn/archives/2af2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lightshaker">
      <meta itemprop="description" content="It is our choices that show what we truly are, far more than our abilities.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Journey">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ROS入门
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-27 21:07:13" itemprop="dateCreated datePublished" datetime="2020-07-27T21:07:13+08:00">2020-07-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-06-12 14:53:01" itemprop="dateModified" datetime="2023-06-12T14:53:01+08:00">2023-06-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/robotics/" itemprop="url" rel="index"><span itemprop="name">robotics</span></a>
                </span>
            </span>

          
            <span id="/archives/2af2/" class="post-meta-item leancloud_visitors" data-flag-title="ROS入门" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/archives/2af2/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/archives/2af2/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>学习内容来源：<a
target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1zt411G7Vn?from=search&amp;seid=968343469818181771">古月居ROS入门21讲</a></p>
</blockquote>
<h3 id="核心概念">核心概念</h3>
<p><strong>通信机制：</strong>松耦合分布式软件框架</p>
<p><strong>Node</strong> 节点</p>
<p><strong>ROS Master</strong> 控制中心/节点管理器</p>
<p><strong>Topic</strong> 话题 -- 发布/订阅式的单向异步通信 &amp;&amp;
<strong>Message</strong> 话题内数据 .msg 话题通信适用于数据传输</p>
<p><strong>Service</strong> 服务 -- 请求/应答式的双向同步通信 .srv
服务通信适用于逻辑处理</p>
<p><strong>Parameter</strong> 参数 --
全局共享字典服务器，节点使用它来存储和检索运行时的参数，适合存储静态、非二进制的配置参数</p>
<p><strong>文件系统：</strong></p>
<ul>
<li><p><strong>Package</strong> 功能包</p>
<p>ROS软件中的基本单元，包含节点源码、配置文件、数据定义等，完成某个特定的功能如人脸识别等。</p></li>
<li><p><strong>Package manifest</strong> 功能包清单</p>
<p>记录功能包的基本信息，包括作者信息、许可信息、依赖选项、编译标志等</p></li>
<li><p><strong>Meta Package</strong> 元功能包</p>
<p>组织多个用于同一目的的功能包</p></li>
</ul>
<span id="more"></span>
<h3 id="ros命令行工具">ROS命令行工具</h3>
<p><strong>常用命令</strong></p>
<p><code>roscore</code>：启动ROS Master</p>
<p><code>rosrun &lt;package&gt; &lt;bin&gt;</code>：启动某个功能包的某个节点，<code>package</code>表示功能包名，<code>bin</code>表示该功能包下的<code>.cpp</code>文件编译生成的可执行文件或赋予可执行权限的<code>.py</code>文件，其中C++程序编译生成的可执行文件一般在<code>Project/devel/lib/packageName</code>路径下。</p>
<p><code>rostopic</code>：话题相关</p>
<ul>
<li><code>rostopic list</code>：查看系统中存在的所有话题名</li>
<li><code>rostopic type topicName</code>：查看指定话题的消息类型</li>
<li><code>rostopic echo topicName</code>：输出指定话题在程序运行过程中传输的消息</li>
</ul>
<p><code>rosmsg</code>：消息相关</p>
<ul>
<li><p><code>rosmsg list</code>：查看系统中存在的所有消息名</p></li>
<li><p><code>rosmsg show msgName</code>：查看指定消息msg的数据结构</p></li>
</ul>
<p><code>rosservice</code>：服务相关</p>
<ul>
<li><code>rosservice list</code>：查询系统中存在的服务</li>
<li>`<code>rosservice type serviceName</code>：查看指定服务的srv类型</li>
</ul>
<p><code>rossrv</code>：服务内容相关</p>
<ul>
<li><code>rossrv list</code>：查看系统中存在的服务内容</li>
<li><code>rossrv type srvName</code>：查看指定服务内容srv的具体数据结构</li>
</ul>
<p><code>rosnode</code>：查询节点相关信息</p>
<ul>
<li><code>rosenode list</code>：查看所有节点名</li>
<li><code>rosenode info nodename</code>：查看节点nodename的信息，包括其发布、订阅的话题，服务通信的内容以及pid和底层通信信息</li>
</ul>
<p><strong>实用工具</strong></p>
<p><code>rosrun rqt_graph rqt_graph</code>：总览整个工程的节点、话题关系</p>
<p><code>ros_bag</code>：记录所有话题数据</p>
<ul>
<li>话题记录：<code>rosbag record -a -O cmd_record</code>，<code>-a</code>表示all，
<code>-O</code>设置保存下来的压缩包名字为
"cmd_record"，默认存<code>/home</code>下</li>
<li>话题复现：<code>rosbag play cmd_record.bag</code></li>
</ul>
<p><strong>小海龟例子</strong></p>
<p>终端一启动ROS Master：<code>roscore</code></p>
<p>终端二启动小海龟仿真器：<code>rosrun turtlesim turtlesim_node</code></p>
<p>终端三启动小海龟键盘控制节点：<code>rosrun turtlesim turtle_teleop_key</code></p>
<p>利用命令行控制海龟移动：</p>
<ul>
<li>查看话题名：<code>rostopic list</code></li>
<li>设置运动速度：<code>rostopic pub /turtle1/cmd_vel geometry_msgs/Twist "：</code>，修改线速度<code>linear</code>和角速度<code>angular</code>
回车即可</li>
<li>坐标轴方向为x朝前，z朝上（小海龟视角），线速度单位是 米/秒，
角速度单位是 弧度/秒</li>
<li>增加一个发送频率使海龟持续移动：<code>pub -r 10</code>
每秒发送10次命令</li>
</ul>
<p>生成第二只海龟：</p>
<ul>
<li>查看生成海龟的服务：<code>rosservice list</code>，其中
<code>/spawn</code> 就是生成海龟的服务</li>
<li>发布服务请求：<code>rosservice call /spawn</code>，设置新海龟的坐标x,
y, z以及名字name，回车即可</li>
</ul>
<p>记录与复现</p>
<ul>
<li>记录所有信息：<code>rosbad record -a -O cmd_record</code>，在<code>/home</code>下就会出现一个名为<code>cmd_record.bag</code>的文件</li>
<li>复现：先关闭之前的进程，重新启动ROS Master和仿真器，再运行
<code>rosbag play cmd_record.bag</code> 即可</li>
</ul>
<h3 id="基本指令">基本指令</h3>
<h4 id="创建工作空间与功能包">创建工作空间与功能包</h4>
<p><strong>关键指令含义：</strong></p>
<ul>
<li><code>catkin_init_workspace</code>：初始化工作空间，在<code>src</code>中生成
<code>CMakeLists.txt</code> 文件</li>
<li><code>catkin_make install</code>：编译<code>src</code>路径下所有功能包的源码，生成三个文件夹：<code>devel</code>，<code>build</code>，<code>install</code></li>
<li><code>catkin_create_pkg</code>：创建功能包<code>test_pkg</code>，依赖于<code>std_msgs</code>、<code>rospy</code>、<code>roscpp</code>，功能包必须在<code>src</code>中创建</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p catkin_ws/src</span><br><span class="line"><span class="built_in">cd</span> catkin_ws/src</span><br><span class="line">catkin_init_workspace</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">catkin_make install</span><br><span class="line"><span class="built_in">cd</span> src/</span><br><span class="line">catkin_create_pkg test_pkg std_msgs rospy roscpp</span><br></pre></td></tr></table></figure>
<p>生成的各个文件夹的含义：</p>
<ul>
<li><p><code>catkin_ws</code>：工作空间根目录</p></li>
<li><p><code>build</code>：编译空间，存放编译过程中生成的中间文件</p></li>
<li><p><code>devel</code>：开发空间，存放开发过程中生成的可执行文件、头文件和库</p></li>
<li><p><code>install</code>：安装空间，存放开发完成后最终编译生成的可执行文件</p></li>
<li><p><code>src</code>：存放所有功能包的源码</p></li>
<li><p><code>test_pkg</code>：功能包，在该路径下生成子文件夹<code>src</code>与<code>include</code>，以及配置文件<code>CMakeLists.txt</code>和<code>package.xml</code></p>
<ul>
<li><code>CMakeLists.txt</code>：设置编译规则</li>
<li><code>package.xml</code>：提供关于功能包的信息，如名称、版本、描述、作者邮箱、开源协议以及依赖信息等</li>
</ul></li>
</ul>
<p>创建完功能包后回到工作空间根目录重新<code>catkin_make</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">catkin_make </span><br></pre></td></tr></table></figure>
<p>将功能包路径添加到系统环境变量中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br></pre></td></tr></table></figure>
<p>查看是否成功添加环境变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$ROS_PACKAGE_PATH</span></span><br></pre></td></tr></table></figure>
<h3 id="publisher-发布者编程实现">Publisher 发布者编程实现</h3>
<p><strong>小海龟示例的通讯例子：</strong></p>
<p><img src="example_publisher.png" alt="话题模型（发布/订阅）"></p>
<p><strong>建立新的工作空间，创建包：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p catkin_ws/src</span><br><span class="line"><span class="built_in">cd</span> catkin_ws/src</span><br><span class="line">catkin_init_workspace</span><br><span class="line">catkin_create_pkg learning_topic roscpp rospy std_msgs geometry_msgs turtlesim</span><br><span class="line">vim learning_topic/velocity_publisher.cpp</span><br></pre></td></tr></table></figure>
<p><strong>Publisher 实现过程（沿用上面的工作空间）：</strong></p>
<ul>
<li>初始化ROS节点</li>
<li>向ROS Master注册节点信息，包括发布的话题名以及话题中的消息类型</li>
<li>创建消息数据</li>
<li>按照一定的频率循环发布消息</li>
</ul>
<p><strong>cpp版本：</strong></p>
<p>velocity_publisher.cpp</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程发布turtle1/cmd_vel话题，消息类型为geometry_msgs::Twist</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;geometry_msgs/Twist.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 初始化ROS节点并创建节点句柄</span></span><br><span class="line">	ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;velocity_publisher&quot;</span>);</span><br><span class="line">	ros::NodeHandle n;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 注册节点，创建Publisher，发布名为&quot;/turtle1/cmd_vel&quot;的话题，消息类型为Twist，队列长度10</span></span><br><span class="line">	ros::Publisher turtle_vel_pub = n.<span class="built_in">advertise</span>&lt;geometry_msgs::Twist&gt;(<span class="string">&quot;turtle1/cmd_vel&quot;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置循环频率</span></span><br><span class="line">	<span class="function">ros::Rate <span class="title">loop_rate</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(ros::<span class="built_in">ok</span>())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// 初始化geometry_msgs::Twist类型的消息</span></span><br><span class="line">		geometry_msgs::Twist vel_msg;</span><br><span class="line">		vel_msg.linear.x = <span class="number">0.5</span>;  <span class="comment">// 线速度</span></span><br><span class="line">		vel_msg.angular.z = <span class="number">0.2</span>;  <span class="comment">// 角速度</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// 发布消息</span></span><br><span class="line">		turtle_vel_pub.<span class="built_in">publish</span>(vel_msg);</span><br><span class="line">		<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Publish turtle velocity command[%0.2f m/s, %0.2f rad/s]&quot;</span>, vel_msg.linear.x, vel_msg.angular.z);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 按照循环频率延时</span></span><br><span class="line">		loop_rate.<span class="built_in">sleep</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>本例程中部分内容的解释</strong></p>
<p>​
<strong>队列：</strong>“队列”的意思就是buffer缓冲区。由于ROS发布和接收并不是同步的，如果发布的速度非常快，例如10ms就能发送一条信息，但接受方并不能做到10ms接受一条信息，为了解决这个问题，要在发送方和接受方之间加一个缓冲区，发送方将数据按照发送顺序写入缓冲区，接受方就从缓冲区里读。队列的长度就是缓冲区的容量，在发送与接受的速度相差不大且队列长度足够时，接受方慢慢读一定是能读完每一条信息的，但如果发送速度远大于接受速度，当队列溢出时，最早写入缓冲区的数据就会被弹出，整个过程类似于双端队列<code>queue</code>。</p>
<p>​ <strong>ros::Rate
loop_rate(10)：</strong>用于控制发布速率，数值10表示将发布速度限制在<code>10hz</code>，这里只是设置了发布的速度，需要配合<code>loop_rate.sleep()</code>进行休眠，才能达到休眠/限速的目的。</p>
<p>​
<strong>ros::ok()：</strong>roscpp默认生成一个SIGNT句柄，它负责处理Ctrl+C键盘操作---使ros::ok()返回false，意味着当前的节点失效。ros::ok()返回false的情况有以下四种：</p>
<ul>
<li>SIGNT被触发，即键盘按下Ctrl+C</li>
<li>被另一个同名节点踢出ROS网络</li>
<li>ros::shutdown()被程序的另一部分调用</li>
<li>节点中的所有ros::NodeHandles都已经被销毁</li>
</ul>
<p>​
<strong>turtle1/cmd_vel：</strong>ROS自带的小海龟例程中的一个话题名，在用<code>rosrun turtlesim turtlesim_node</code>启动小海龟节点后，可用<code>rostopic list</code>查找到该话题，如图1所示。在明确知道话题名时，可用<code>rostopic type /turtle1/cmd_vel</code>查看该话题的消息类型，如图1所示，消息类型为<code>geometry_msgs/Twist</code>，在程序中标注消息类型时需要引入同名头文件<code>#include &lt;geometry_msgs/Twist.h&gt;</code>，使用该消息类型时，要用命名空间的形式，如<code>geometry_msgs::Twist</code>。</p>
<p><img src = "pub_rostopic.png" alt="图1 小海龟rostopic"></p>
<p>​
另外，也可以用<code>rosmsg list</code>查找到该消息名称，如图2所示。要知道如何在程序中设置消息内容，可以使用<code>rosmsg show geometry/Twist</code>查看该消息在程序中可用的数据类型，如图3所示，该消息包含了线速度<code>linear</code>和角速度<code>angular</code>两个结构体，其中又分别包含了<code>x</code>,<code>y</code>,<code>z</code>三个分量，在程序中可以访问类public成员的方式设置和使用这些数据，例如<code>vel_msg.linear.x</code>或<code>vel_msg.angular.z</code>。</p>
<p><img src = "pub_rosmsg_list.png" alt="图2 小海龟rosmsg list"></p>
<p><img src = "pub_rosmsg_show.png" alt= "图3 geometry_msgs/Twist的具体数据结构"></p>
<p><strong>CMakeLists.txt</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加待编译文件与链接库</span></span><br><span class="line"><span class="keyword">add_executable</span>(velocity_publisher src/velocity_publisher.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(velocity_publisher <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)</span><br></pre></td></tr></table></figure>
<p>编译运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 终端一</span></span><br><span class="line"><span class="built_in">cd</span> ~/catkin_ws</span><br><span class="line">catkin_make</span><br><span class="line">rescore</span><br><span class="line"><span class="comment"># 终端二</span></span><br><span class="line">rosrun turtlesim turtlesim_node </span><br><span class="line"><span class="comment"># 终端三</span></span><br><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br><span class="line">rosrun learning_ropic velocity_publisher </span><br></pre></td></tr></table></figure>
<p>需要注意的是，<code>source</code>
执行的命令只对当前的终端有效，而终端三才用到我们自己写的<code>velocity_publisher</code>，因此需要在启动终端三时再执行一次
<code>source</code>，否则 <code>rosrun</code> 无法找到
<code>learning_topic</code> 功能包。</p>
<p><strong>python版本：</strong></p>
<p>为了将cpp和py文件区分开，在<code>learning_topic</code>路径下新建一个文件夹<code>scripts</code>用于存放py源码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws/src/learning_topic</span><br><span class="line"><span class="built_in">mkdir</span> scripts &amp;&amp; <span class="built_in">cd</span> scripts</span><br><span class="line">vim velocity_publisher.py</span><br></pre></td></tr></table></figure>
<p>velocity_publisher.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># 该例程发布turtle1/cmd_vel话题，消息类型geometry_msgs::Twist</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> Twist</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">velocity_publisher</span>():</span><br><span class="line">    <span class="comment"># 初始化</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;velocity_publisher&quot;</span>, anonymous=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 注册节点，创建Publisher，发布名为&quot;/turtle1/cmd_vel&quot;的话题，消息类型为Twist，队列长度10</span></span><br><span class="line">    turtle_vel_pub = rospy.Publisher(<span class="string">&#x27;/turtle1/cmd_vel&#x27;</span>, Twist, queue_size=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置循环频率</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        <span class="comment"># 初始化geometry_msgs::Twist类型的消息</span></span><br><span class="line">        vel_msg = Twist()</span><br><span class="line">        vel_msg.linear.x = <span class="number">0.5</span></span><br><span class="line">        vel_msg.angular.z = <span class="number">0.2</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 发布消息</span></span><br><span class="line">        turtle_vel_pub.publish(vel_msg)</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;Publish turtle velocity command[%0.2f ms, %0.2f rad/s]&quot;</span>, vel_msg.linear.x, vel_msg.angular.z)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 按照循环频率延时</span></span><br><span class="line">        rate.sleep();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        velocity_publisher();</span><br><span class="line">    <span class="keyword">except</span> rospy.ROSInterruptException:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>由于python是解释性语言，因此需要给py文件加上可执行权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x velocity_publisher.py</span><br></pre></td></tr></table></figure>
<p>运行时仅终端三的命令与cpp不同：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/catkin/devel/setup.bash</span><br><span class="line">rosrun learning_topic velocity_publisher.py</span><br></pre></td></tr></table></figure>
<h3 id="subscriber-订阅者编程实现">Subscriber 订阅者编程实现</h3>
<p><strong>小海龟通讯机制</strong></p>
<p><img src="example_subscriber.png" alt="话题模型（发布/订阅）"></p>
<p>此处沿用 Publisher 的工作空间，不做改动，只添加 Subscriber：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws/src/learning_topic/src</span><br><span class="line">vim pose_subscriber.cpp</span><br></pre></td></tr></table></figure>
<p><strong>Subscriber的实现过程：</strong></p>
<ul>
<li><p>初始化ROS节点</p></li>
<li><p>向ROS
Master注册节点信息，包括订阅的话题名以及话题中的消息类型</p></li>
<li><p>循环等待话题消息，接收到消息后进入回调函数，在回调函数中处理消息</p></li>
<li><p>继续循环等待话题消息</p></li>
</ul>
<p><strong>cpp版本：</strong></p>
<p>pose_subscriber.cpp</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程订阅/turtle1/pose话题，消息类型为turtlesim::Pose</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;turtlesim/Pose.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 回调函数，在接收到订阅消息后进入</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">poseCallback</span><span class="params">(<span class="type">const</span> turtlesim::Pose::ConstPtr&amp; msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 打印订阅的消息</span></span><br><span class="line">	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Turtle pose: x:%0.6f, y:%0.6f&quot;</span>, msg-&gt;x, msg-&gt;y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// 初始化</span></span><br><span class="line">	ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;pose_subscriber&quot;</span>);</span><br><span class="line">	ros::NodeHandle n;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 注册订阅者，并订阅名为&quot;/turtle1/pose&quot;的话题，同时注册回调函数</span></span><br><span class="line">	ros::Subscriber pose_sub = n.<span class="built_in">subscribe</span>(<span class="string">&quot;/turtle1/pose&quot;</span>, <span class="number">10</span>, poseCallback);</span><br><span class="line">  <span class="comment">// 循环查询topic缓冲区队列</span></span><br><span class="line">	ros::<span class="built_in">spin</span>(); </span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>例程中部分内容的解释</strong></p>
<p>​ <strong>poseCallback：</strong>n.subscribe()订阅名为
<code>/turtle1/pose</code>
的话题，接收器每一次接受到消息时都会调用)名为<code>poseCallback</code>
的函数，称为回调函数，在回调函数中处理接受到的信息。回调函数的参数
<code>const turtlesim::Pose::ConstPtr&amp; msg</code>
是指向具体消息类型的指针，指针形式 <code>constPtr&amp;</code>
是固定的，区别只在于前面的消息类型 <code>turtlesim::Pose</code>
。使用该指针的方式为
<code>msg-&gt;data</code>，data为指定消息的具体数据结构，在本例中
<code>turtlesim::Pose</code> 的数据结构中包含了
<code>float32 x</code>，因此可以用 <code>msg-&gt;x</code>
直接读取该数据。另外需要注意的是，ROS中的回调函数返回值只能为空。</p>
<p>​
<strong>ros::spinOnce()：</strong>运行至该语句时，程序同样会到相应的topic订阅缓冲区查看是否存在消息，如果存在就将消息传入回调函数，如果不存在就继续执行程序接下来的语句。</p>
<p>​
<strong>ros::spin()：</strong>运行至该语句时，程序同样会到相应的topic订阅缓冲区查看是否存在消息，如果存在就将消息传入回调函数，但是如果消息不存在就会一直重复上面的查询操作。总的来说，<code>spin</code>
相当于处于 <code>while(1)</code> 死循环内的
<code>spinOnce()</code>，<code>spinOnce</code>
只查询一次，有消息就传参给回调函数，没有就继续执行程序，而
<code>spin</code> 会一直循环查询和传参，终止 <code>spin</code>
的方式与终止 <code>ros::ok()</code> 相同。</p>
<p>CMakeLists.txt</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加待编译文件与链接库</span></span><br><span class="line"><span class="keyword">add_executable</span>(pose_subscriber src/pose_subscriber.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(velocity_publisher <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)</span><br></pre></td></tr></table></figure>
<p>编译运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 终端一</span></span><br><span class="line"><span class="built_in">cd</span> ~/catkin_ws</span><br><span class="line">catkin_make</span><br><span class="line">rescore</span><br><span class="line"><span class="comment"># 终端二</span></span><br><span class="line">rosrun turtlesim turtlesim_node </span><br><span class="line"><span class="comment"># 终端三</span></span><br><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br><span class="line">rosrun learning_ropic velocity_publisher</span><br></pre></td></tr></table></figure>
<p>通过键盘控制或利用刚刚写的Publisher让海龟动起来就能看到终端三中的数据变化</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br><span class="line"><span class="comment"># 键盘控制</span></span><br><span class="line">rosrun turtlesim turtle_teleop_key</span><br><span class="line"><span class="comment"># 运行Publisher</span></span><br><span class="line">rosrun learning_topic velocity_publisher</span><br></pre></td></tr></table></figure>
<p><strong>python版本：</strong></p>
<p>同理在<code>sciprts</code>文件夹中添加
<code>pose_subscriber.py</code> 文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws/src/learning_topic/scripts</span><br><span class="line">vim pose_subscriber.py</span><br></pre></td></tr></table></figure>
<p>pose_subscriber.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># 该例程订阅 turtle1/Pose 话题，消息类型turtlesim::Pose</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> turtlesim.msg <span class="keyword">import</span> Pose</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">poseCallback</span>(<span class="params">msg</span>):</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;Turtle pose: x:%0.6f, y:%0.6f&quot;</span>, msg.x, msg.y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pose_subscriber</span>():</span><br><span class="line">    rospy.init_node(<span class="string">&quot;pose_subscriber&quot;</span>, anonymous=<span class="literal">True</span>)</span><br><span class="line">    rospy.Subscriber(<span class="string">&quot;/turtle1/pose&quot;</span>, Pose, poseCallback)</span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pose_subscriber()</span><br></pre></td></tr></table></figure>
<p>加上可执行权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x pose_subscriber.py</span><br></pre></td></tr></table></figure>
<p>运行 pose_subscriber.py：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br><span class="line">rosrun learning_topic pose_subscriber.py</span><br></pre></td></tr></table></figure>
<h3 id="话题消息自定义与使用">话题消息自定义与使用</h3>
<p><img src="自定义msg.png" alt="Person话题消息自定义"></p>
<p><strong>自定义话题消息数据类型的方式：</strong></p>
<ul>
<li>创建msg文件</li>
<li>在<code>package.xml</code>文件中添加功能包依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>message_generation<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>message_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在<code>CMakeLists.txt</code>中添加编译选项</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(... message_generation)</span><br><span class="line">add_message_files(FILES Person.msg)</span><br><span class="line">generation_messages(DEPENDENCIES std_msgs)</span><br><span class="line">catkin_package(... message_runtime)</span><br></pre></td></tr></table></figure>
<ul>
<li>编译生成与自定义数据相关的头文件</li>
</ul>
<p><strong>cpp版本</strong></p>
<ul>
<li>沿用<code>learning_topic</code>功能包，在功能包路径下创建<code>msg</code>文件夹，在文件夹中创建<code>Person.msg</code>数据文件，内容如下：</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">string name</span><br><span class="line">uint8 sex</span><br><span class="line">uint8 age</span><br><span class="line"></span><br><span class="line">uint8 unknown = 0</span><br><span class="line">uint8 male = 1</span><br><span class="line">uint8 female = 2</span><br></pre></td></tr></table></figure>
<ul>
<li>设置<code>package.xml</code>和<code>CMakeLists.txt</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>message_generation<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>message_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">2.8</span>.<span class="number">3</span>)</span><br><span class="line"><span class="keyword">project</span>(learning_topic)</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_package</span>(catkin REQUIRED COMPONENTS</span><br><span class="line">  geometry_msgs</span><br><span class="line">  roscpp</span><br><span class="line">  rospy</span><br><span class="line">  std_msgs</span><br><span class="line">  turtlesim</span><br><span class="line">  message_generation</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">add_message_files(</span><br><span class="line">  FILES</span><br><span class="line">  Person.msg</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">generate_messages(</span><br><span class="line">  DEPENDENCIES</span><br><span class="line">  std_msgs</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">catkin_package(</span><br><span class="line"> CATKIN_DEPENDS geometry_msgs roscpp rospy std_msgs turtlesim message_runtime</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">include_directories</span>(</span><br><span class="line">  <span class="variable">$&#123;catkin_INCLUDE_DIRS&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>执行<code>catkin_make</code>编译工程后，在<code>devel/include/learning_topic/</code>工程路径内会生成一个<code>Person.h</code>头文件，对应刚刚创建的<code>Person.msg</code></li>
<li>在<code>learning_topic/src</code>路径下创建<code>person_publisher.cpp</code>和<code>person_subscriber.cpp</code>源文件</li>
</ul>
<p><strong>person_publisher.cpp</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程将发布/person_info话题，自定义消息类型learning_topic::Person</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span>...</span></span><br><span class="line">&lt;build_depend&gt;message_generation&lt;/build_depend&gt;</span><br><span class="line">&lt;exec_depend&gt;message_runtime&lt;/exec_depend&gt;</span><br><span class="line">...</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;learning_topic/Person.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ROS节点初始化</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;person_publisher&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个Publisher，发布名为/person_info的topic，消息类型为learning_topic::Person，队列长度10</span></span><br><span class="line">    ros::Publisher person_info_pub = n.<span class="built_in">advertise</span>&lt;learning_topic::Person&gt;(<span class="string">&quot;/person_info&quot;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置循环的频率</span></span><br><span class="line">    <span class="function">ros::Rate <span class="title">loop_rate</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 初始化learning_topic::Person类型的消息</span></span><br><span class="line">    	learning_topic::Person person_msg;</span><br><span class="line">		person_msg.name = <span class="string">&quot;Tom&quot;</span>;</span><br><span class="line">		person_msg.age  = <span class="number">18</span>;</span><br><span class="line">		person_msg.sex  = learning_topic::Person::male;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发布消息</span></span><br><span class="line">		person_info_pub.<span class="built_in">publish</span>(person_msg);</span><br><span class="line"></span><br><span class="line">       	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Publish Person Info: name:%s  age:%d  sex:%d&quot;</span>, </span><br><span class="line">				  person_msg.name.<span class="built_in">c_str</span>(), person_msg.age, person_msg.sex);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 按照循环频率延时</span></span><br><span class="line">        loop_rate.<span class="built_in">sleep</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>person_subscriber.cpp</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程将订阅/person_info话题，自定义消息类型learning_topic::Person</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;learning_topic/Person.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收到订阅的消息后，会进入消息回调函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">personInfoCallback</span><span class="params">(<span class="type">const</span> learning_topic::Person::ConstPtr&amp; msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 将接收到的消息打印出来</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Subcribe Person Info: name:%s  age:%d  sex:%d&quot;</span>, </span><br><span class="line">			 msg-&gt;name.<span class="built_in">c_str</span>(), msg-&gt;age, msg-&gt;sex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化ROS节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;person_subscriber&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个Subscriber，订阅名为/person_info的topic，注册回调函数personInfoCallback</span></span><br><span class="line">    ros::Subscriber person_info_sub = n.<span class="built_in">subscribe</span>(<span class="string">&quot;/person_info&quot;</span>, <span class="number">10</span>, personInfoCallback);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环等待回调函数</span></span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>CMakeLists.txt</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(person_publisher src/person_publisher.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(person_publisher <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)</span><br><span class="line"><span class="keyword">add_dependencies</span>(person_publisher <span class="variable">$&#123;PROJECT_NAME&#125;</span>_generate_messages_cpp)</span><br><span class="line"><span class="comment"># 注：add_dependencies将可执行文件与之前编译生成的Person头文件相关联</span></span><br><span class="line"><span class="keyword">add_executable</span>(person_subscriber src/person_subscriber.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(person_subscriber <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)</span><br><span class="line"><span class="keyword">add_dependencies</span>(person_subscriber <span class="variable">$&#123;PROJECT_NAME&#125;</span>_generate_messages_cpp)</span><br></pre></td></tr></table></figure>
<p>编译运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws</span><br><span class="line">catkin_make</span><br><span class="line"><span class="comment"># 终端一</span></span><br><span class="line">roscore</span><br><span class="line"><span class="comment"># 终端二</span></span><br><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br><span class="line">rosrun learning_topic person_publisher</span><br><span class="line"><span class="comment"># 终端三</span></span><br><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br><span class="line">rosrun learning_topic person_subscriber</span><br></pre></td></tr></table></figure>
<p>运行结果如图所示</p>
<p><img src="person_msg运行结果.png" alt="自定义话题消息运行结果"></p>
<p><strong>python版本</strong></p>
<ul>
<li>在<code>/learning_topic/scripts</code>路径下创建<code>person_publisher.py</code>和<code>person_subscriber.py</code>文件</li>
</ul>
<p><strong>person_publisher.py</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># 该例程将发布/person_info话题，自定义消息类型learning_topic::Person</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> learning_topic.msg <span class="keyword">import</span> Person</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">velocity_publisher</span>():</span><br><span class="line">	<span class="comment"># ROS节点初始化</span></span><br><span class="line">    rospy.init_node(<span class="string">&#x27;person_publisher&#x27;</span>, anonymous=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 创建一个Publisher，发布名为/person_info的topic，消息类型为learning_topic::Person，队列长度10</span></span><br><span class="line">    person_info_pub = rospy.Publisher(<span class="string">&#x27;/person_info&#x27;</span>, Person, queue_size=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">#设置循环的频率</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">10</span>) </span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">		<span class="comment"># 初始化learning_topic::Person类型的消息</span></span><br><span class="line">    	person_msg = Person()</span><br><span class="line">    	person_msg.name = <span class="string">&quot;Tom&quot;</span>;</span><br><span class="line">    	person_msg.age  = <span class="number">18</span>;</span><br><span class="line">    	person_msg.sex  = Person.male;</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 发布消息</span></span><br><span class="line">        person_info_pub.publish(person_msg)</span><br><span class="line">    	rospy.loginfo(<span class="string">&quot;Publsh person message[%s, %d, %d]&quot;</span>, </span><br><span class="line">				person_msg.name, person_msg.age, person_msg.sex)</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 按照循环频率延时</span></span><br><span class="line">        rate.sleep()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        velocity_publisher()</span><br><span class="line">    <span class="keyword">except</span> rospy.ROSInterruptException:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>person_subscriber.py</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># 该例程将订阅/person_info话题，自定义消息类型learning_topic::Person</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> learning_topic.msg <span class="keyword">import</span> Person</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">personInfoCallback</span>(<span class="params">msg</span>):</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;Subcribe Person Info: name:%s  age:%d  sex:%d&quot;</span>, </span><br><span class="line">			 msg.name, msg.age, msg.sex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">person_subscriber</span>():</span><br><span class="line">	<span class="comment"># ROS节点初始化</span></span><br><span class="line">    rospy.init_node(<span class="string">&#x27;person_subscriber&#x27;</span>, anonymous=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 创建一个Subscriber，订阅名为/person_info的topic，注册回调函数personInfoCallback</span></span><br><span class="line">    rospy.Subscriber(<span class="string">&quot;/person_info&quot;</span>, Person, personInfoCallback)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 循环等待回调函数</span></span><br><span class="line">    rospy.spin()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    person_subscriber()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>设置可执行权限，运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x person_publisher.py person_subscriber.py</span><br><span class="line">roscore</span><br><span class="line">rosrun learning_topic person_publisher.py</span><br><span class="line">rosrun learning_topic person_subscriber.py</span><br></pre></td></tr></table></figure>
<h3 id="client-服务器客户端编程实现">Client 服务器客户端编程实现</h3>
<p>Client客户端发布<code>/spawn</code>服务请求，服务端turtlesim接收到后回复，生成新的小海龟</p>
<p>服务的数据类型为：<code>turtlesim::Spawn</code></p>
<p><img src="example_client.png" alt="小海龟客户端例程"></p>
<p>创建功能包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> catkin_ws/src</span><br><span class="line">catkin_create_pkg learning_service roscpp rospy std_msgs geometry_msgs turtlesim</span><br></pre></td></tr></table></figure>
<p><strong>Client的实现过程：</strong></p>
<ul>
<li>初始化ROS节点</li>
<li>创建一个Client实例</li>
<li>发布服务请求数据</li>
<li>等待Server处理之后的应答结果</li>
</ul>
<p><strong>cpp版本：</strong></p>
<p>turtle_spawn.cpp</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程将请求/spawn服务，服务数据类型turtlesim::Spawn</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;turtlesim/Spawn.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;turtle_spawn&quot;</span>);</span><br><span class="line">	ros::NodeHandle node;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 发现/spawn服务唤醒后，创建一个服务客户端，连接名为/spawn的service</span></span><br><span class="line">	ros::service::<span class="built_in">waitForService</span>(<span class="string">&quot;/spawn&quot;</span>);</span><br><span class="line">	ros::ServiceClient add_turtle = node.<span class="built_in">serviceClient</span>&lt;turtlesim::Spawn&gt;(<span class="string">&quot;/spawn&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 初始化turtlesim::Spawn的请求数据</span></span><br><span class="line">	turtlesim::Spawn srv;</span><br><span class="line">	srv.request.x = <span class="number">2.0</span>;</span><br><span class="line">	srv.request.y = <span class="number">2.0</span>;</span><br><span class="line">	srv.request.name = <span class="string">&quot;turtle2&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 请求服务调用</span></span><br><span class="line">	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Call service to spawn turtle[x:%0.6f, y:%0.6f, name:%s]&quot;</span>,</span><br><span class="line">		srv.request.x, srv.request.y, srv.request.name.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">	add_turtle.<span class="built_in">call</span>(srv);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 显示服务调用结果</span></span><br><span class="line">	<span class="built_in">ROS_INFO</span>(<span class="string">&quot;Spawn turtle successfully [name:%s]&quot;</span>, srv.response.name.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>CMakeLists.txt</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(turtle_spawn src/turtle_spawn.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(turtle_spawn <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)</span><br></pre></td></tr></table></figure>
<p>编译运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 终端一</span></span><br><span class="line"><span class="built_in">cd</span> ~/catkin_ws</span><br><span class="line">catkin_make</span><br><span class="line">rescore</span><br><span class="line"><span class="comment"># 终端二</span></span><br><span class="line">rosrun turtlesim turtlesim_node </span><br><span class="line"><span class="comment"># 终端三</span></span><br><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br><span class="line">rosrun learning_service turtle_spawn</span><br></pre></td></tr></table></figure>
<p><strong>python版本：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> ~/catkin_ws/src/learning_service/scripts</span><br><span class="line"><span class="built_in">cd</span> ~/catkin_ws/src/learning_service/scripts</span><br><span class="line"><span class="built_in">touch</span> turtle_spawn.py</span><br></pre></td></tr></table></figure>
<p>turtle_spawn.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># # -*- coding: utf -8 -*-</span></span><br><span class="line"><span class="comment"># 该例程将请求/spawn服务，服务数据类型为turtlesim::Spawn</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> turtlesim.srv <span class="keyword">import</span> Spawn</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">turtle_spawn</span>():</span><br><span class="line">    <span class="comment"># ROS节点初始化</span></span><br><span class="line">    rospy.init_node(<span class="string">&#x27;turtle_spawn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 等待/spawn服务被唤醒后，创建服务客户端，连接名为/spawn的service</span></span><br><span class="line">    rospy.wait_for_service(<span class="string">&#x27;/spawn&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        add_turtle = rospy.ServiceProxy(<span class="string">&#x27;/spawn&#x27;</span>, Spawn)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 调用service，类型为Spawn，参数为x,y,z,name</span></span><br><span class="line">        response = add_turtle(<span class="number">2.0</span>, <span class="number">2.0</span>, <span class="number">0.0</span>, <span class="string">&quot;turtle2&quot;</span>) </span><br><span class="line">        <span class="keyword">return</span> response.name</span><br><span class="line">    <span class="keyword">except</span> rospy.ServiceException, e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Service call failed: %s&quot;</span> %e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment">#调用服务并显示调用结果</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Spawn turtle successfully [name:%s]&quot;</span> %(turtle_spawn()))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>加上可执行权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x turtle_spawn.py</span><br></pre></td></tr></table></figure>
<p>运行 pose_subscriber.py：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br><span class="line">rosrun learning_service turtle_spawn.py</span><br></pre></td></tr></table></figure>
<h3 id="server-服务器服务端编程实现">Server 服务器服务端编程实现</h3>
<p>服务端通过查询回调函数队列，接收客户端发出的服务请求，回调函数参数std_srvs::Trigger作为类触发器，包含了<code>Trigger::Request</code>和<code>Trigger::Response</code>两种数据类型，查询到服务请求时就触发，进入回调函数，做出回应。</p>
<p>服务的数据类型为<code>std_srvs::Trigger</code></p>
<p><img src="example_server.png" alt="小海龟服务端例程"></p>
<p><strong>Server的实现流程</strong></p>
<ul>
<li>初始化ROS节点</li>
<li>创建服务端Server实例</li>
<li>循环等待服务请求，进入回调函数</li>
<li>在回调函数中完成服务功能的处理，并反馈应答数据</li>
</ul>
<p><strong>cpp版本</strong></p>
<p>沿用客户端的功能包，在<code>src</code>路径下创建新文件<code>turtle_command_server.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程将执行/turtle_command服务，服务数据类型std_srvs/Trigger</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;geometry_msgs/Twist.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;std_srvs/Trigger.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//服务端反馈时发布指令</span></span><br><span class="line">ros::Publisher turtle_vel_pub;  </span><br><span class="line"><span class="type">bool</span> pubCommand = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Service回调函数，输入参数req，输出参数res</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">commandCallback</span><span class="params">(std_srvs::Trigger::Request &amp;req,</span></span></span><br><span class="line"><span class="params"><span class="function">                    std_srvs::Trigger::Response &amp;res)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pubCommand = !pubCommand;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示请求数据</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Publish turtle velocity command [%s]&quot;</span>, pubCommand==<span class="literal">true</span>?<span class="string">&quot;Yes&quot;</span>:<span class="string">&quot;No&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置反馈数据</span></span><br><span class="line">    res.success = <span class="literal">true</span>;</span><br><span class="line">    res.message = <span class="string">&quot;Change turtle command state!&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 节点初始化</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;turtle_command_server&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个名为 &quot;/turtle_command&quot;的服务端，注册回调函数为commandCallback</span></span><br><span class="line">    ros::ServiceServer comand_server = n.<span class="built_in">advertiseService</span>(<span class="string">&quot;/turtle_command&quot;</span>, commandCallback);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建发布器，发布名为 &quot;/turtle1/cmd_vel&quot;的话题，消息类型为 geometry::Twist，队列长度为10</span></span><br><span class="line">    turtle_vel_pub = n.<span class="built_in">advertise</span>&lt;geometry_msgs::Twist&gt;(<span class="string">&quot;/turtle1/cmd_vel&quot;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环等待回调函数，循环频率为10</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Ready to receive turtle command.&quot;</span>);</span><br><span class="line">    <span class="function">ros::Rate <span class="title">loop_rate</span><span class="params">(<span class="number">10</span>)</span></span>; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 查看一次回调函数队列</span></span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 队列中有消息时回调函数被调用，条件成立，发布速度指令</span></span><br><span class="line">        <span class="keyword">if</span>(pubCommand)</span><br><span class="line">        &#123;</span><br><span class="line">            geometry_msgs::Twist vel_msgs;</span><br><span class="line">            vel_msgs.linear.x = <span class="number">0.5</span>;</span><br><span class="line">            vel_msgs.angular.z = <span class="number">0.2</span>;</span><br><span class="line">            turtle_vel_pub.<span class="built_in">publish</span>(vel_msgs);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 按照循环频率延时</span></span><br><span class="line">        loop_rate.<span class="built_in">sleep</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>本例程中部分内容的解释</strong></p>
<p>​
利用<code>rossrv show std_srvs/Trigger</code>查看服务的具体数据类型，如图所示，三短横<code>---</code>分割了Request和Response的内容，由于Request的数据需要由客户端决定，因此这里只能看到Response的默认数据结构为<code>bool success</code>和<code>string message</code>，分别表示服务请求是否收到，以及发送回客户端的提示信息。</p>
<p><img src="Trigger.png" alt="服务std_srv/Trigger数据结构"></p>
<p>CMakeLists.txt</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(turtle_command_server src/turtle_command_server.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(turtle_command_server <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)</span><br></pre></td></tr></table></figure>
<p>编译运行</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 终端一</span></span><br><span class="line">cd ~/catkin_ws</span><br><span class="line">catkin_make</span><br><span class="line">rescore</span><br><span class="line"><span class="comment"># 终端二</span></span><br><span class="line">rosrun turtlesim turtlesim_node </span><br><span class="line"><span class="comment"># 终端三</span></span><br><span class="line">source devel/setup.bash</span><br><span class="line">rosrun learning_ropic turtle_command_server</span><br><span class="line"><span class="comment"># 终端四，手动发送一个服务请求</span></span><br><span class="line">rosservice call /turtle_command <span class="string">&quot;&#123;&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<p>运行效果如图所示，在执行<code>turtle_command_server</code>后，使用<code>rosservice list</code>就可以查找到我们在cpp程序中创建的名为<code>/turtle_command</code>的服务。</p>
<p><img src="turtle_command_server1.png"></p>
<p><img src="turtle_command_server2.png"></p>
<p><img src="turtle_command_server3.png" alt="turtle_command_server运行效果"></p>
<p><strong>python版本</strong></p>
<p>turtle_command_server.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># 该例程将执行/turtle_command服务，服务数据类型为std_srvs/Trigger</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> geometry_msgs.msg <span class="keyword">import</span> Twist</span><br><span class="line"><span class="keyword">from</span> std_srvs.srv <span class="keyword">import</span> Trigger, TriggerResponse</span><br><span class="line"></span><br><span class="line">pubCommand = <span class="literal">False</span>;</span><br><span class="line">turtle_vel_pub = rospy.Publisher(<span class="string">&#x27;/turtle1/cmd_vel&#x27;</span>, Twist, queue_size=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">command_thread</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> pubCommand:</span><br><span class="line">            vel_msg = Twist()</span><br><span class="line">            vel_msg.linear.x = <span class="number">0.5</span></span><br><span class="line">            vel_msg.angular.z = <span class="number">0.2</span></span><br><span class="line">            turtle_vel_pub.publish(vel_msg)</span><br><span class="line">            </span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">commandCallback</span>(<span class="params">req</span>):</span><br><span class="line">    <span class="keyword">global</span> pubCommand</span><br><span class="line">    pubCommand = <span class="built_in">bool</span>(<span class="number">1</span> - pubCommand)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示请求数据</span></span><br><span class="line">    rospy.loginfo(<span class="string">&quot;Publish turtle velocity command![%d]&quot;</span>, pubCommand)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 反馈数据（success和message）</span></span><br><span class="line">    <span class="keyword">return</span> TriggerResponse(<span class="number">1</span>, <span class="string">&quot;Change turtle command state!&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">turtle_command_server</span>():</span><br><span class="line">    <span class="comment"># ROS节点初始化</span></span><br><span class="line">    rospy.init_node(<span class="string">&#x27;turtle_command_server&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建一个名为/turtle_command的server，注册回到函数commandCallback</span></span><br><span class="line">    s = rospy.Service(<span class="string">&#x27;/turtle_command&#x27;</span>, Trigger, commandCallback)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 循环等待回调函数</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Ready to receive turtle command&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    thread.start_new_thread(command_thread, ())</span><br><span class="line">    rospy.spin()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    turtle_command_server()</span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<p>添加可执行权限，运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x turtle_command_server.py</span><br><span class="line">rosrun learning_service turtle_command_server.py</span><br><span class="line">rosservice call /turtle_command <span class="string">&quot;&#123;&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="服务数据自定义与使用">服务数据自定义与使用</h3>
<p><img src="自定义srv.png" alt="自定义服务数据"></p>
<p><strong>自定义服务数据类型的方式：</strong></p>
<ul>
<li><p>创建srv文件，用<code>---</code>分割Request数据和Response数据</p></li>
<li><p>在<code>package.xml</code>文件中添加功能包依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>message_generation<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>message_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>在<code>CMakeLists.txt</code>中添加编译选项</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(... message_generation)</span><br><span class="line">add_service_files(FILES Person.srv)</span><br><span class="line">generation_messages(DEPENDENCIES std_msgs)</span><br><span class="line">catkin_package(... message_runtime)</span><br></pre></td></tr></table></figure></li>
<li><p>编译生成与自定义数据相关的头文件</p></li>
</ul>
<p><strong>cpp版本</strong></p>
<ul>
<li><p>沿用learning_service功能包，在该功能包路径下创建名为<code>srv</code>的文件夹，在文件夹内创建<code>Person.srv</code>数据文件，文件内容如下：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">string name</span><br><span class="line">uint8 age</span><br><span class="line">uint8 sex</span><br><span class="line"></span><br><span class="line">uint8 unknown = 0</span><br><span class="line">uint8 male = 1</span><br><span class="line">uint8 female = 2</span><br><span class="line">---</span><br><span class="line">string result</span><br></pre></td></tr></table></figure></li>
<li><p>设置<code>package.xml</code>和<code>CMakeLists.txt</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>message_generation<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>message_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">2.8</span>.<span class="number">3</span>)</span><br><span class="line"><span class="keyword">project</span>(learning_service)</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_package</span>(catkin REQUIRED COMPONENTS</span><br><span class="line">  geometry_msgs</span><br><span class="line">  roscpp</span><br><span class="line">  rospy</span><br><span class="line">  std_msgs</span><br><span class="line">  turtlesim</span><br><span class="line">  message_generation</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">add_service_files(FILES Person.srv)</span><br><span class="line">generate_messages(DEPENDENCIES std_msgs)</span><br><span class="line"></span><br><span class="line">catkin_package(</span><br><span class="line">  CATKIN_DEPENDS geometry_msgs roscpp rospy std_msgs turtlesim message_runtime</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">include_directories</span>(</span><br><span class="line">  <span class="variable">$&#123;catkin_INCLUDE_DIRS&#125;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(turtle_spawn src/turtle_spawn.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(turtle_spawn <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(turtle_command_server src/turtle_command_server.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(turtle_command_server <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>执行<code>catkin_make</code>编译整个工程，在<code>devel/include/learning_service</code>路径下会生成三个<code>.h</code>头文件，分别为<code>Person.h</code>、<code>PersonRequest.h</code>和<code>PersonResponse.h</code>，如图所示，
因为<code>Person.h</code>内包含了另外两个头文件，因此使用时只包含<code>Person.h</code>就行。</p></li>
</ul>
<p><img src="srv_header_files.png" alt="srv编译生成的头文件"></p>
<ul>
<li>在<code>learning_service/src</code>路径下创建<code>person_client.cpp</code>和<code>person_server.cpp</code></li>
</ul>
<p><strong>person_client.cpp</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程将请求/show_person服务，服务数据类型learning_service::Person</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;learning_service/Person.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化ROS节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;person_client&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">    ros:NodeHandle node;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检测到系统中存在/spawn服务后，创建客户端连接该服务</span></span><br><span class="line">    ros::service::<span class="built_in">waitForService</span>(<span class="string">&quot;/show_person&quot;</span>);</span><br><span class="line">    ros::ServiceClient person_client = node.<span class="built_in">serviceClient</span>&lt;learning_service::Person&gt;(<span class="string">&quot;/show_person&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化learning_service::Person的服务请求数据</span></span><br><span class="line">    learning_service::Person srv;</span><br><span class="line">    srv.request.name = <span class="string">&quot;Tom&quot;</span>;</span><br><span class="line">    srv.request.age = <span class="number">20</span>;</span><br><span class="line">    srv.request.sex = learning_service::Person::Request::male;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 请求服务调用</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Call service to show person[name:%s, age:%d, sex:%d]&quot;</span>, </span><br><span class="line">        srv.request.name.<span class="built_in">c_str</span>(), srv.request.age, srv.request.sex);</span><br><span class="line"></span><br><span class="line">    person_client.<span class="built_in">call</span>(srv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示服务调用结果</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Show person result: %s&quot;</span>, srv.response.result.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>person_server.cpp</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 该例程将执行/show_person服务，服务数据类型learning_service::Person</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ros/ros.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;learning_service/Person.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// service回调函数，输入参数req，输出参数res</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">personCallback</span><span class="params">(learning_service::Person::Request  &amp;req,</span></span></span><br><span class="line"><span class="params"><span class="function">                    learning_service::Person::Response &amp;res)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 显示请求数据</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Person: name:%s  age:%d  sex:%d&quot;</span>, req.name.<span class="built_in">c_str</span>(), req.age, req.sex);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置反馈数据</span></span><br><span class="line">    res.result = <span class="string">&quot;OK&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ROS节点初始化</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;person_server&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建节点句柄</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个名为/show_person的server，注册回调函数personCallback</span></span><br><span class="line">    ros::ServiceServer person_service = n.<span class="built_in">advertiseService</span>(<span class="string">&quot;/show_person&quot;</span>, personCallback);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环等待回调函数</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Ready to show person information.&quot;</span>);</span><br><span class="line">    ros:<span class="built_in">spin</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>CMakeLists.txt</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(person_server src/person_server.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(person_server <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)</span><br><span class="line"><span class="keyword">add_dependencies</span>(person_server <span class="variable">$&#123;PROJECT_NAME&#125;</span>_gencpp)</span><br><span class="line"><span class="comment"># 注：add_dependencies将可执行文件与之前编译生成的Person头文件相关联</span></span><br><span class="line"><span class="keyword">add_executable</span>(person_client src/person_client.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(person_client <span class="variable">$&#123;catkin_LIBRARIES&#125;</span>)</span><br><span class="line"><span class="keyword">add_dependencies</span>(person_client <span class="variable">$&#123;PROJECT_NAME&#125;</span>_gencpp)</span><br></pre></td></tr></table></figure>
<p>编译运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/catkin_ws</span><br><span class="line">catkin_make</span><br><span class="line"><span class="comment"># 终端一</span></span><br><span class="line">roscore</span><br><span class="line"><span class="comment"># 终端二</span></span><br><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br><span class="line">rosrun learning_service person_server</span><br><span class="line"><span class="comment"># 终端三</span></span><br><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br><span class="line">rosrun learning_service person_client</span><br></pre></td></tr></table></figure>
<p>运行效果如图所示</p>
<p><img src="person运行结果.png" alt="show person运行结果"></p>
<p>通常情况下是先运行服务端<code>person_server</code>再运行客户端<code>person_client</code>，在本例中如果先运行客户端的话，由于<code>waitForService</code>的存在，程序也不会中断，会一直等到服务端启动，<code>/show_person</code>服务被创建之后执行<code>call</code>命令、</p>
<p><strong>python版本</strong></p>
<ul>
<li>在<code>/learning_service/script</code>路径下创建<code>person_client.py</code>和<code>person_server.py</code></li>
</ul>
<p><strong>person_client.py</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#　该例程将请求/show_person服务，服务数据类型learning_service::Person</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> learning_service.srv <span class="keyword">import</span> Person, PersonRequest</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">person_client</span>():</span><br><span class="line">    <span class="comment"># ROS节点初始化</span></span><br><span class="line">    rospy.init_node(<span class="string">&#x27;person_client&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检测到系统中存在/spawn服务后，创建客户端连接该服务</span></span><br><span class="line">    rospy.wait_for_service(<span class="string">&#x27;/show_person&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        person_client = rospy.ServiceProxy(<span class="string">&#x27;/show_person&#x27;</span>, Person)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 请求服务调用，输入请求数据</span></span><br><span class="line">        response = person_client(<span class="string">&quot;Tom&quot;</span>, <span class="number">20</span>, PersonRequest.male)</span><br><span class="line">        <span class="keyword">return</span> response.result</span><br><span class="line">    <span class="keyword">except</span> rospy.ServiceException <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Service cal failed:%s&quot;</span>, e)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 服务调用并显示调用结果</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Show person result: %s&quot;</span> %(person_client()))</span><br></pre></td></tr></table></figure>
<p><strong>person_server.py</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># 该例程将执行/show_person服务，服务数据类型learning_service::Person</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> learning_service.srv <span class="keyword">import</span> Person, PersonResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">personCallback</span>(<span class="params">req</span>):</span><br><span class="line">    <span class="comment"># 显示请求数据</span></span><br><span class="line">    rospy.loginfo(<span class="string">&quot;Person: name:%s  age:%d  sex:%d&quot;</span>, req.name, req.age, req.sex)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 反馈数据</span></span><br><span class="line">    <span class="keyword">return</span> PersonResponse(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">person_server</span>():</span><br><span class="line">    <span class="comment"># ROS节点初始化</span></span><br><span class="line">    rospy.init_node(<span class="string">&#x27;person_server&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建一个名为/show_person的server，注册回调函数personCallback</span></span><br><span class="line">    s = rospy.Service(<span class="string">&#x27;/show_person&#x27;</span>, Person, personCallback)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 循环等待回调函数</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Ready to show person information.&quot;</span>)</span><br><span class="line">    rospy.spin()</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    person_server()</span><br></pre></td></tr></table></figure>
<p>设置可执行权限，运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x person_client.py person_server.py</span><br><span class="line">roscore</span><br><span class="line">rosrun learning_service person_client.py</span><br><span class="line">rosrun learning_service person_server.py</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/ROS/" rel="tag"># ROS</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/archives/1806/" rel="prev" title="GCC与CMake入门">
      <i class="fa fa-chevron-left"></i> GCC与CMake入门
    </a></div>
      <div class="post-nav-item">
    <a href="/archives/aff9/" rel="next" title="从xacro模型文件建立机械臂仿真环境">
      从xacro模型文件建立机械臂仿真环境 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-number">1.</span> <span class="nav-text">核心概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ros%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7"><span class="nav-number">2.</span> <span class="nav-text">ROS命令行工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4"><span class="nav-number">3.</span> <span class="nav-text">基本指令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%B7%A5%E4%BD%9C%E7%A9%BA%E9%97%B4%E4%B8%8E%E5%8A%9F%E8%83%BD%E5%8C%85"><span class="nav-number">3.1.</span> <span class="nav-text">创建工作空间与功能包</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#publisher-%E5%8F%91%E5%B8%83%E8%80%85%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.</span> <span class="nav-text">Publisher 发布者编程实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#subscriber-%E8%AE%A2%E9%98%85%E8%80%85%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="nav-number">5.</span> <span class="nav-text">Subscriber 订阅者编程实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%9D%E9%A2%98%E6%B6%88%E6%81%AF%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="nav-number">6.</span> <span class="nav-text">话题消息自定义与使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#client-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="nav-number">7.</span> <span class="nav-text">Client 服务器客户端编程实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#server-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="nav-number">8.</span> <span class="nav-text">Server 服务器服务端编程实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E6%95%B0%E6%8D%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="nav-number">9.</span> <span class="nav-text">服务数据自定义与使用</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Lightshaker</p>
  <div class="site-description" itemprop="description">It is our choices that show what we truly are, far more than our abilities.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">24</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">闽ICP备2022005091号-1 </a>
      <img src="/images/beian-logo.png" style="display: inline-block;">
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lightshaker</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.5.1/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'j3EqSOqSYjPS414YtmiadN5W-gzGzoHsz',
      appKey     : '429Gb8wTQv1P09Fjbeyd9k5w',
      placeholder: "Hello",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
